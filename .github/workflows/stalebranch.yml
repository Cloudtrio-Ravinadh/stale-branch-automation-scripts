
name: List Stale Branches with Report
on:
 workflow_dispatch

permissions:
  contents: write

jobs:
  stale_branches:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: List Stale Branches
      uses: crs-k/stale-branches@v5.0.0
      with:
        repo-token: "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"
        days-before-stale: 240
        days-before-delete: 99999
        comment-updates: false
        max-issues: 50
        tag-committer: false
        stale-branch-label: 'stale branch 🗑️'
        compare-branches: 'info'
        branches-filter-regex: '^((?!dependabot))'
        rate-limit: false
        pr-check: false
        dry-run: true
        ignore-issue-interaction: false

    - name: Save Report of Stale Branches
      run: |
        echo "Generating report for stale branches..."
        echo "Repository: ${{ github.repository }}" > stale_branches_report.txt
        echo "Generated on: $(date)" >> stale_branches_report.txt
        echo "Stale Branches (inactive for over 8 months):" >> stale_branches_report.txt
        echo "" >> stale_branches_report.txt

        # List stale branches using the action's output
        stale_branches=$(cat $GITHUB_WORKSPACE/stale-branches-output.log || echo "No stale branches found.")
        echo "$stale_branches" >> stale_branches_report.txt

    - name: Upload Report
      uses: actions/upload-artifact@v3
      with:
        name: stale-branches-report
        path: stale_branches_report.txt

  
