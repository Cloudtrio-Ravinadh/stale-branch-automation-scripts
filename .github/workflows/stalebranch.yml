
# .github/workflows/stale-branches.yml

name: Stale Branches and its report

on:
  schedule:
    - cron: '0 6 * * 1-5'
    
permissions:
  issues: write
  contents: write

jobs:
  stale_branches:
    runs-on: ubuntu-latest
    steps:
    - name: Stale Branches
      uses: crs-k/stale-branches@v5.0.0
      with:
        repo-token: '${{ secrets.GITHUB_TOKEN }}'
        days-before-stale: 120
        days-before-delete: 180
        comment-updates: false
        max-issues: 20
        tag-committer: false
        stale-branch-label: 'stale branch 🗑️'
        compare-branches: 'info'
        branches-filter-regex: '^((?!dependabot))'
        rate-limit: false
        pr-check: false
        dry-run: false
        ignore-issue-interaction: false
        


    - name: Save Report of Stale Branches
      run: |
        echo "Generating report for stale branches..."
        echo "Repository: ${{ github.repository }}" > stale_branches_report.txt
        echo "Generated on: $(date)" >> stale_branches_report.txt
        echo "Stale Branches (inactive for over 8 months):" >> stale_branches_report.txt
        echo "" >> stale_branches_report.txt

        # List stale branches using the action's output
        stale_branches=$(cat $GITHUB_WORKSPACE/stale-branches-output.log || echo "No stale branches found.")
        echo "$stale_branches" >> stale_branches_report.txt

    - name: Upload Report
      uses: actions/upload-artifact@v3
      with:
        name: stale-branches-report
        path: stale_branches_report.txt

  
